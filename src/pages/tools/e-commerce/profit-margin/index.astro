---
import BaseLayout from "../../../../components/layout/BaseLayout.astro";
---

<BaseLayout
  title="Profit Margin Calculator — Free & Instant | SimpleTools"
  description="Calculate your real net profit and net margin after all variable costs. Free, no login, instant results."
>
  <!-- ===================== -->
  <!-- Header / Intro -->
  <!-- ===================== -->
  <section class="calcHeader">
    <span class="badge">Free • No login • Instant</span>
    <h1>Profit Margin Calculator</h1>
    <p>
      Calculate your real net profit and net margin after all variable costs.
      Designed for quick decisions with clear formulas.
    </p>
  </section>

  <!-- ===================== -->
  <!-- Calculator Body -->
  <!-- ===================== -->
  <section class="calcBody">
    <!-- Left : Inputs -->
    <div class="calcInputs" id="pm_inputs">
      <div class="inputGroup">
        <label for="pm_price">Selling price (USD)</label>
        <input id="pm_price" type="number" inputmode="decimal" step="0.01" min="0" placeholder="e.g. 50" />
      </div>

      <div class="inputGroup">
        <label for="pm_cogs">Product cost (COGS)</label>
        <input id="pm_cogs" type="number" inputmode="decimal" step="0.01" min="0" placeholder="e.g. 15" />
      </div>

      <div class="inputGroup">
        <label for="pm_platform_fee">Platform fee (%)</label>
        <input id="pm_platform_fee" type="number" inputmode="decimal" step="0.01" min="0" placeholder="e.g. 15" />
      </div>

      <div class="inputGroup">
        <label for="pm_payment_fee">Payment fee (%)</label>
        <input id="pm_payment_fee" type="number" inputmode="decimal" step="0.01" min="0" placeholder="e.g. 2.9" />
      </div>

      <div class="inputGroup">
        <label for="pm_shipping">Shipping cost</label>
        <input id="pm_shipping" type="number" inputmode="decimal" step="0.01" min="0" placeholder="e.g. 5" />
      </div>

      <div class="inputGroup">
        <label for="pm_ads">Ad cost per order</label>
        <input id="pm_ads" type="number" inputmode="decimal" step="0.01" min="0" placeholder="e.g. 10" />
      </div>
    </div>

    <!-- Right : Results -->
    <div class="calcResults">
      <div class="resultCard" aria-live="polite">
        <div class="resultItem">
          <span>Net Profit</span>
          <strong id="pm_net_profit">$0.00</strong>
        </div>

        <div class="resultItem">
          <span>Net Margin</span>
          <strong id="pm_net_margin">0%</strong>
        </div>
      </div>
    </div>
  </section>

  <!-- ===================== -->
  <!-- Content / SEO -->
  <!-- ===================== -->
  <section class="content">
    <h2>How it works</h2>
    <p>
      The calculator subtracts all variable costs from your selling price.
      Percentage-based fees are calculated from revenue, while shipping and
      advertising are treated as fixed costs per order.
    </p>

    <h2>Formula</h2>
    <pre>
Net profit =
Price
− Product cost
− (Platform fee % × Price)
− (Payment fee % × Price)
− Shipping
− Ads

Net margin (%) =
(Net profit ÷ Price) × 100
    </pre>

    <h2>FAQ</h2>
    <p><strong>Does this include taxes?</strong><br />
      No. Taxes vary by location and are not included.
    </p>

    <p><strong>Which platforms is this for?</strong><br />
      Amazon, Shopify, Etsy, or any platform with percentage-based fees.
    </p>

    <p><strong>Is this calculator free?</strong><br />
      Yes. No login or payment is required.
    </p>
  </section>

  <!-- ===================== -->
  <!-- Logic (JS) -->
  <!-- ===================== -->
  <script is:inline>
    (function () {
      const $ = (id) => document.getElementById(id);

      const elPrice = $("pm_price");
      const elCogs = $("pm_cogs");
      const elPlatformFee = $("pm_platform_fee");
      const elPaymentFee = $("pm_payment_fee");
      const elShipping = $("pm_shipping");
      const elAds = $("pm_ads");

      const elNetProfit = $("pm_net_profit");
      const elNetMargin = $("pm_net_margin");

      function toNum(v) {
        const n = Number(v);
        return Number.isFinite(n) ? n : 0;
      }

      function clampMin0(n) {
        return n < 0 ? 0 : n;
      }

      function formatUSD(n) {
        // Allow negative profit display (important)
        const sign = n < 0 ? "-" : "";
        const abs = Math.abs(n);
        return sign + abs.toLocaleString("en-US", { style: "currency", currency: "USD" });
      }

      function formatPct(n) {
        // n already in percent units
        if (!Number.isFinite(n)) return "0%";
        const rounded = Math.round(n * 10) / 10; // 1 decimal
        // Show -0 as 0
        const safe = Object.is(rounded, -0) ? 0 : rounded;
        return safe.toLocaleString("en-US") + "%";
      }

      function calc() {
        const price = clampMin0(toNum(elPrice.value));
        const cogs = clampMin0(toNum(elCogs.value));
        const platformPct = clampMin0(toNum(elPlatformFee.value)) / 100;
        const paymentPct = clampMin0(toNum(elPaymentFee.value)) / 100;
        const shipping = clampMin0(toNum(elShipping.value));
        const ads = clampMin0(toNum(elAds.value));

        const platformFee = price * platformPct;
        const paymentFee = price * paymentPct;

        const netProfit = price - cogs - platformFee - paymentFee - shipping - ads;
        const netMargin = price > 0 ? (netProfit / price) * 100 : 0;

        elNetProfit.textContent = formatUSD(netProfit);
        elNetMargin.textContent = formatPct(netMargin);
      }

      // Bind events
      const inputs = [elPrice, elCogs, elPlatformFee, elPaymentFee, elShipping, elAds];
      inputs.forEach((input) => {
        input.addEventListener("input", calc);
        input.addEventListener("change", calc);
      });

      // Optional: set reasonable defaults for instant feedback (commented)
      // elPrice.value = 50;
      // elCogs.value = 15;
      // elPlatformFee.value = 15;
      // elPaymentFee.value = 2.9;
      // elShipping.value = 5;
      // elAds.value = 10;

      calc();
    })();
  </script>

  <!-- ===================== -->
  <!-- Styles -->
  <!-- ===================== -->
  <style>
    /* ===== Header ===== */
    .calcHeader {
      max-width: 1100px;
      margin: 0 auto;
      padding: 48px 20px 32px;
    }

    .badge {
      display: inline-block;
      font-size: 12px;
      padding: 6px 12px;
      border-radius: 999px;
      background: #eef4ff;
      color: #245bdb;
    }

    .calcHeader h1 {
      font-size: 32px;
      margin: 12px 0;
    }

    .calcHeader p {
      color: #555;
      max-width: 560px;
    }

    /* ===== Body ===== */
    .calcBody {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 20px 60px;
      display: grid;
      grid-template-columns: 1.4fr 1fr;
      gap: 32px;
    }

    @media (max-width: 900px) {
      .calcBody {
        grid-template-columns: 1fr;
      }
    }

    /* ===== Inputs ===== */
    .calcInputs {
      background: #fff;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.04);
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .inputGroup {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    label {
      font-size: 14px;
      font-weight: 500;
    }

    input {
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid #ddd;
      font-size: 15px;
      outline: none;
    }

    input:focus {
      border-color: #b8cdfd;
      box-shadow: 0 0 0 4px rgba(36, 91, 219, 0.08);
    }

    /* ===== Results ===== */
    .calcResults {
      align-self: flex-start;
    }

    .resultCard {
      background: #fff;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.04);
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .resultItem span {
      font-size: 14px;
      color: #666;
    }

    .resultItem strong {
      font-size: 32px;
      font-weight: 600;
      display: block;
      margin-top: 4px;
    }

    /* ===== Content ===== */
    .content {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px 80px;
    }

    .content h2 {
      margin-top: 32px;
    }

    pre {
      background: #f3f4f6;
      padding: 20px;
      border-radius: 12px;
      font-size: 14px;
      overflow-x: auto;
      margin-top: 12px;
    }
  </style>
</BaseLayout>
